# 🎫 スタンプアプリ

QRコードをスキャンしてポイントとスタンプを集める簡単なWebアプリです。

## ✨ 機能

### 受講生向け機能
- **QRコードスキャン**: カメラを使用してQRコードを読み取り
- **ポイントシステム**: QRコード1回につき10ポイント獲得
- **スタンプカード**: 3回参加でスタンプが3つ貯まる
- **半額クーポン**: 3つのスタンプで半額クーポンをGET
- **データ保存**: ブラウザのローカルストレージに進捗を保存
- **PWA対応**: スマートフォンにアプリとしてインストール可能

### 管理者向け機能
- **固定パスワード管理**: シンプルな「1580」パスワードシステム
- **直接確認**: 管理者が受講生のアプリに直接入力
- **重複防止**: 各受講生1回のみ自動制限
- **即座に確認**: ポイント付与を目の前で確認可能

## 🚀 使用方法

1. **Webサーバーで起動**:
   ```bash
   # Python 3を使用する場合
   python -m http.server 8000

   # Node.jsのhttp-serverを使用する場合
   npx http-server
   ```

2. **ブラウザでアクセス**:
   `http://localhost:8000` にアクセス

3. **QRコードスキャン**:
   - 「スキャン開始」ボタンをクリック
   - カメラ使用許可を与える
   - "STAMP"を含むQRコードをスキャン

4. **テスト用機能**:
   - ブラウザの開発者コンソールで `testScan()` を実行すると、テスト用のQRスキャンをシミュレートできます

## 📱 PWAインストール

1. ChromeまたはEdgeでアプリにアクセス
2. アドレスバーの「インストール」アイコンをクリック
3. スマートフォンのホーム画面にアプリが追加されます

## 🛠️ 技術仕様

- **フロントエンド**: HTML5, CSS3, JavaScript (ES6+)
- **QRスキャン**: html5-qrcode ライブラリ
- **データ保存**: localStorage
- **PWA**: Service Worker + Web App Manifest

## 🔧 カスタマイズ

### QRコードの検証ルール
`script.js` の `handleQRCodeScan()` メソッドでQRコードの検証ロジックを変更できます：

```javascript
// 現在は"STAMP"を含むQRコードのみ有効
if (!decodedText.includes('STAMP')) {
    this.showMessage('無効なQRコードです', 'error');
    return;
}
```

### ポイント/スタンプ数の変更
- ポイント獲得数: `addPoints(10)` の値を変更
- 必要スタンプ数: 3つの部分を任意の数に変更

## 🔧 管理者用パスワード発行システム

### 🎯 新しい動的パスワードシステム
**管理者認証**: `admin1580`
**研修パスワード**: 4桁の自動生成（例：7392）

### アクセス方法
1. `admin.html` にアクセス
2. 管理者パスワード「**admin1580**」を入力してログイン
3. パスワード管理画面にアクセス

### 🚀 運用フロー
1. **管理者ログイン**: admin.htmlで「admin1580」を入力
2. **パスワード生成**: 「新しいパスワードを生成」ボタンをクリック
3. **パスワード配布**: 生成された4桁パスワードを受講生に告知
   - スクリーンに投影
   - 口頭で伝える
   - ホワイトボードに記載
4. **受講生入力**: 各受講生が自分のスマホアプリに入力
5. **使用状況確認**: 管理者画面で何人が使用したか確認

### 🔒 セキュリティ機能
- **管理者認証**: 管理者パスワードで保護
- **4桁ランダム**: 毎回異なる予測不可能なパスワード
- **重複利用防止**: 各受講生1回のみ自動制限
- **使用履歴**: 使用者数と最終使用時刻を記録
- **リセット機能**: 必要に応じて使用履歴をリセット

### ✅ 管理機能
- 📊 **使用状況確認**: 何人がパスワードを使用したか表示
- 🔄 **状況更新**: リアルタイムで状況を確認
- 🗑️ **履歴リセット**: 全員が再利用できるようにリセット
- 🎲 **新パスワード生成**: 前回のパスワードを無効化して新しいパスワードを発行

### 💡 利用シーン
- **研修会開始時**: 新しいパスワードを生成して配布
- **セッション毎**: 必要に応じて新しいパスワードに変更
- **トラブル時**: 使用履歴をリセットして再配布
- **確認時**: 使用状況をリアルタイムで確認

## 📂 ファイル構成

```
stamp-app/
├── index.html      # 受講生用メインページ
├── admin.html      # 管理者用QRコード生成ページ
├── style.css       # 受講生用スタイルシート
├── admin.css       # 管理者用スタイルシート
├── script.js       # 受講生用JavaScriptロジック
├── admin.js        # 管理者用JavaScriptロジック
├── manifest.json   # PWAマニフェスト
├── sw.js          # サービスワーカー
└── README.md      # このファイル
```

## 📱 カメラアクセス対応

### ✅ カメラが使用可能な環境
- **HTTPS環境**: 完全にサポート
- **localhost (HTTP)**: サポート (127.0.0.1:8000 等)

### ❌ カメラが制限される環境
- **HTTP環境**: セキュリティ制限により使用不可

### 🔧 HTTP環境での対処法
カメラアクセスができない場合、以下のフォールバック機能が利用できます：

1. **手動入力機能**:
   - 入力欄に「STAMP」を含むテキストを入力
   - 「手動スキャン」ボタンで同様の効果

2. **テスト機能**:
   - 「テスト用QRスキャン」ボタンで動作確認
   - 「簡単テスト」でポイント・スタンプ追加

### 🌐 HTTPS サーバー起動方法
```bash
# Python 3.x を使用
python -m http.server 8000 --bind 127.0.0.1

# Node.js serve を使用（要インストール）
npx serve . -s -p 8000

# live-server を使用（要インストール）
npx live-server --port=8000 --host=127.0.0.1
```

## 🔒 セキュリティ注意事項

- HTTPSでの運用を推奨（カメラアクセスのため）
- QRコード検証ロジックを実装済み（重複防止、STAMP文字チェック）
- 本番環境では追加のセキュリティ対策が必要

## 📄 ライセンス

MIT License